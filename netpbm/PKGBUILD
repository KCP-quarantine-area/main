
pkgname=netpbm
pkgver=10.66.02
pkgrel=1
pkgdesc="A toolkit for manipulation of graphic images"
arch=('x86_64')
license=('custom' 'BSD' 'GPL' 'LGPL')
url="http://netpbm.sourceforge.net/"
depends=('perl' 'libjpeg-turbo' 'libpng' 'libtiff' 'libxml2' 'libx11')
makedepends=('python2' 'subversion')
options=('!makeflags')

build() {
  cd "${srcdir}"
  svn checkout http://svn.code.sf.net/p/netpbm/code/advanced netpbm
  
  cd "${srcdir}/netpbm"
  
  cp config.mk.in  config.mk
  echo 'CFLAGS_SHLIB = -fPIC' >> config.mk
  echo "NETPBM_DOCURL = file://${srcdir}/doc" >> config.mk
  echo 'TIFFLIB = libtiff.so' >> config.mk
  echo 'JPEGLIB = libjpeg.so' >> config.mk
  echo 'PNGLIB = libpng.so' >> config.mk
  echo 'ZLIB = libz.so' >> config.mk
 
  sed -i 's|misc|share/netpbm|' common.mk
  sed -i 's|/link|/lib|' lib/Makefile

  make
}

package() {
  cd "${srcdir}/netpbm"
  make package pkgdir="${pkgdir}/usr"
  
  install -D -m644 "${srcdir}/netpbm/doc/copyright_summary" \
    "${pkgdir}/usr/share/licenses/${pkgname}/copyright_summary.txt"
    
  mv -iv "${pkgdir}/usr/man" "${pkgdir}/usr/share/man"
}
